<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>DownAPK 26</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --ios-bg: #000000;
            --ios-card: #1C1C1E;
            --ios-blue: #0A84FF;
            --ios-text: #FFFFFF;
            --ios-subtext: #8E8E93;
            --ios-separator: #38383A;
            --ios-blur: rgba(28, 28, 30, 0.85);
            --glass-border: 1px solid rgba(255, 255, 255, 0.1);
            --radius-l: 32px;
            --radius-m: 18px;
        }

        body { 
            font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", sans-serif; 
            margin: 0; background: var(--ios-bg); color: var(--ios-text); 
            padding-bottom: 120px; overflow-x: hidden; -webkit-font-smoothing: antialiased;
        }

        a { text-decoration: none !important; color: inherit !important; -webkit-tap-highlight-color: transparent; }

        header { padding: 50px 20px 10px; display: flex; justify-content: flex-start; align-items: center; }
        .logo { font-size: 34px; font-weight: 800; letter-spacing: -1px; }

        /* FEATURED BANNER */
        .featured-banner {
            margin: 15px 20px 30px; background: #111; border-radius: var(--radius-l);
            height: 420px; position: relative; overflow: hidden; display: flex;
            flex-direction: column; justify-content: flex-end; border: var(--glass-border);
            box-shadow: 0 20px 40px rgba(0,0,0,0.6);
        }
        .featured-img-bg {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background-size: cover !important; background-position: center !important;
            filter: brightness(0.5); z-index: 1;
        }
        .featured-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(to bottom, transparent 0%, rgba(0,0,0,0.95) 100%);
            z-index: 2;
        }
        .featured-info { position: relative; z-index: 3; padding: 30px; text-align: center; display: flex; flex-direction: column; align-items: center; }
        .featured-tag { color: #bf55ec; font-size: 11px; font-weight: 800; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 10px; }
        .featured-title { font-size: 28px; font-weight: 800; margin-bottom: 5px; color: white !important; }
        .featured-desc { font-size: 15px; color: var(--ios-subtext); margin-bottom: 20px; }
        .get-btn { background: #FFFFFF; color: #000; padding: 12px 50px; border-radius: 25px; font-weight: 700; font-size: 16px; border: none; }

        /* SECTIONS */
        .section-title { padding: 20px 20px 15px; font-size: 22px; font-weight: 700; display: flex; justify-content: space-between; align-items: center; }
        .section-more { color: var(--ios-blue); font-size: 16px; font-weight: 400; cursor: pointer; }

        .horizontal-scroll { display: flex; overflow-x: auto; padding: 0 20px 25px; gap: 18px; scrollbar-width: none; }
        .horizontal-scroll::-webkit-scrollbar { display: none; }

        .card-item { width: 120px; min-width: 120px; cursor: pointer; }
        .card-icon { width: 120px; height: 120px; border-radius: 26px; object-fit: cover; border: var(--glass-border); margin-bottom: 10px; background: #222; }
        .card-name { font-size: 14px; font-weight: 500; margin-bottom: 2px; display: block; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; color: white !important; }
        .card-author { font-size: 12px; color: var(--ios-subtext); }

        /* LIST STYLE */
        .app-list-container { background: var(--ios-card); margin: 0 20px; border-radius: var(--radius-m); padding: 0 16px; border: var(--glass-border); }
        .app-item { display: flex; padding: 15px 0; border-bottom: 0.5px solid var(--ios-separator); align-items: center; cursor: pointer; }
        .app-item:last-child { border-bottom: none; }
        .app-icon { width: 62px; height: 62px; border-radius: 14px; margin-right: 15px; border: var(--glass-border); background: #222; object-fit: cover; }
        .app-info { flex-grow: 1; min-width: 0; }
        .app-name { font-weight: 600; font-size: 17px; margin-bottom: 3px; color: #FFF !important; }
        .app-meta { font-size: 13px; color: var(--ios-subtext); }
        .laden-badge { background: #333; color: var(--ios-blue); padding: 6px 18px; border-radius: 20px; font-weight: 800; font-size: 12px; }

        /* SEARCH BAR */
        .search-bar {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.98); backdrop-filter: blur(30px);
            z-index: 5000; transform: translateY(-100%); transition: 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            padding-top: 60px;
        }
        .search-bar.active { transform: translateY(0); }
        .search-box { display: flex; align-items: center; padding: 0 20px; gap: 15px; }
        .input-wrap { flex: 1; background: #222; border-radius: 14px; display: flex; align-items: center; padding: 12px 15px; border: var(--glass-border); }
        .input-wrap input { background: transparent; border: none; color: white; font-size: 17px; width: 100%; outline: none; }

        /* NAV */
        .bottom-nav {
            position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%);
            width: 240px; height: 74px; background: var(--ios-blur);
            backdrop-filter: blur(35px) saturate(160%); border-radius: 37px;
            display: flex; justify-content: space-evenly; align-items: center;
            z-index: 4000; border: var(--glass-border); box-shadow: 0 20px 50px rgba(0,0,0,0.9);
        }
        .nav-item { color: rgba(255,255,255,0.4); text-align: center; cursor: pointer; }
        .nav-item.active { color: #FFF; }
        .nav-item i { font-size: 24px; display: block; margin-bottom: 4px; }
        .nav-item span { font-size: 10px; font-weight: 600; text-transform: uppercase; }

        .hidden { display: none; }
    </style>
</head>
<body>

<div class="search-bar" id="search-overlay">
    <div class="search-box">
        <div class="input-wrap">
            <i class="fas fa-search" style="color:#8E8E93"></i>
            <input type="text" id="search-input" placeholder="Tausende Apps durchsuchen...">
        </div>
        <span onclick="toggleSearch(false)" style="color:var(--ios-blue); font-size:17px; cursor:pointer;">Abbrechen</span>
    </div>
    <div id="search-results" class="app-list-container" style="margin-top:20px; max-height: 75vh; overflow-y: auto;"></div>
</div>

<header>
    <div class="logo">Home</div>
</header>

<div id="content-main">
    <div id="featured-hero"></div>

    <div class="section-title">Angesagt <i class="fas fa-chevron-right" onclick="viewAll('Angesagt')" style="font-size:14px; opacity:0.3; cursor:pointer;"></i></div>
    <div class="horizontal-scroll" id="scroll-trending"></div>

    <div class="section-title">Top Apps <span class="section-more" onclick="viewAll('Top Apps')">Alle</span></div>
    <div class="horizontal-scroll" id="scroll-top"></div>

    <div class="section-title">Neueste Updates</div>
    <div id="update-feed" class="app-list-container"></div>
</div>

<nav class="bottom-nav">
    <div class="nav-item active" id="btn-home" onclick="toggleSearch(false)">
        <i class="fas fa-house"></i>
        <span>Home</span>
    </div>
    <div class="nav-item" id="btn-search" onclick="toggleSearch(true)">
        <i class="fas fa-magnifying-glass"></i>
        <span>Suche</span>
    </div>
</nav>

<script>
    let appDatabase = [
        { name: "PhotoSwooper", author: "krille-chan", pkg: "com.github.krille_chan.photoswooper", icon: "https://f-droid.org/repo/com.github.krille_chan.photoswooper/en-US/icon.png", ver: "2.1.0" },
        { name: "OmWeather", author: "woheller69", pkg: "org.woheller69.omweather", icon: "https://f-droid.org/repo/org.woheller69.omweather/en-US/icon.png", ver: "1.5.2" },
        { name: "NewPipe", author: "Team NewPipe", pkg: "org.schabi.newpipe", icon: "https://f-droid.org/repo/org.schabi.newpipe/en-US/icon.png", ver: "0.27.0" },
        { name: "Telegram FOSS", author: "Telegram", pkg: "org.telegram.messenger", icon: "https://f-droid.org/repo/org.telegram.messenger/en-US/icon.png", ver: "10.3.1" },
        { name: "AdAway", author: "AdAway", pkg: "org.adaway", icon: "https://f-droid.org/repo/org.adaway/en-US/icon.png", ver: "6.1.1" },
        { name: "F-Droid", author: "F-Droid", pkg: "org.fdroid.fdroid", icon: "https://f-droid.org/repo/org.fdroid.fdroid/en-US/icon.png", ver: "1.19" },
        { name: "AntennaPod", author: "AntennaPod", pkg: "de.danoeh.antennapod", icon: "https://f-droid.org/repo/de.danoeh.antennapod/en-US/icon.png", ver: "3.2.0" },
        { name: "VLC", author: "VideoLAN", pkg: "org.videolan.vlc", icon: "https://f-droid.org/repo/org.videolan.vlc/en-US/icon.png", ver: "3.5.4" }
    ];

    async function loadFDroidApps() {
        try {
            // Änderung: Abruf über die interne API statt direkt von F-Droid
            const response = await fetch('/api/apps');
            const data = await response.json();
            
            // Mapping der API-Daten (packageName -> pkg, version -> ver)
            const remoteApps = data.map(app => ({
                name: app.name,
                author: app.author,
                pkg: app.packageName,
                icon: app.icon,
                ver: app.version
            }));
            
            appDatabase = [...appDatabase, ...remoteApps];
            render(); 
        } catch (e) { console.log("API konnte nicht geladen werden, verwende interne Liste.", e); }
    }

    function shuffle(array) { return array.sort(() => Math.random() - 0.5); }

    function toggleSearch(show) {
        document.getElementById('search-overlay').classList.toggle('active', show);
        document.getElementById('btn-search').classList.toggle('active', show);
        document.getElementById('btn-home').classList.toggle('active', !show);
        if(show) document.getElementById('search-input').focus();
    }

    function viewAll(title) {
        toggleSearch(true);
        document.getElementById('search-input').value = ""; 
        performSearch(""); 
    }

    function render() {
        const shuffled = shuffle([...appDatabase]);
        const feat = shuffled[0];
        document.getElementById('featured-hero').innerHTML = `
            <div class="featured-banner" onclick="window.location.href='app.html?id=${feat.pkg}'">
                <div class="featured-img-bg" style="background: url('${feat.icon}') center/cover"></div>
                <div class="featured-overlay"></div>
                <div class="featured-info">
                    <span class="featured-tag">DownAPK Empfehlung</span>
                    <div class="featured-title">${feat.name}</div>
                    <div class="featured-desc">Von ${feat.author} • Jetzt laden</div>
                    <div class="get-btn">Laden</div>
                </div>
            </div>
        `;

        const trending = document.getElementById('scroll-trending');
        const top = document.getElementById('scroll-top');
        const feed = document.getElementById('update-feed');
        trending.innerHTML = ""; top.innerHTML = ""; feed.innerHTML = "";
        
        shuffled.slice(0, 8).forEach(app => {
            trending.innerHTML += `<div class="card-item" onclick="window.location.href='app.html?id=${app.pkg}'"><img src="${app.icon}" class="card-icon" onerror="this.src='https://f-droid.org/repo/${app.pkg}/en-US/icon.png'"><span class="card-name">${app.name}</span><span class="card-author">${app.author}</span></div>`;
        });

        [...shuffled].reverse().slice(0, 8).forEach(app => {
            top.innerHTML += `<div class="card-item" onclick="window.location.href='app.html?id=${app.pkg}'"><img src="${app.icon}" class="card-icon" onerror="this.src='https://f-droid.org/repo/${app.pkg}/en-US/icon.png'"><span class="card-name">${app.name}</span><span class="card-author">${app.author}</span></div>`;
        });

        shuffled.slice(0, 15).forEach(app => {
            feed.innerHTML += `<div class="app-item" onclick="window.location.href='app.html?id=${app.pkg}'"><img src="${app.icon}" class="app-icon"><div class="app-info"><div class="app-name">${app.name}</div><div class="app-meta">Version ${app.ver} • ${app.author}</div></div><div class="laden-badge">LADEN</div></div>`;
        });
    }

    function performSearch(query) {
        const resultsBox = document.getElementById('search-results');
        resultsBox.innerHTML = "";
        const filtered = query === "" ? appDatabase.slice(0, 20) : appDatabase.filter(a => a.name.toLowerCase().includes(query.toLowerCase()) || a.pkg.toLowerCase().includes(query.toLowerCase())).slice(0, 50);
        
        if(filtered.length === 0) {
            resultsBox.innerHTML = "<div style='padding:40px; color:#888; text-align:center;'>Keine Apps gefunden.</div>";
        } else {
            filtered.forEach(app => {
                resultsBox.innerHTML += `<div class="app-item" onclick="window.location.href='app.html?id=${app.pkg}'"><img src="${app.icon}" class="app-icon"><div class="app-info"><div class="app-name">${app.name}</div><div class="app-meta">${app.pkg}</div></div><div class="laden-badge">LADEN</div></div>`;
            });
        }
    }

    document.getElementById('search-input').addEventListener('input', (e) => performSearch(e.target.value));

    window.onload = () => {
        render();
        loadFDroidApps();
    };
</script>
</body>
</html>
